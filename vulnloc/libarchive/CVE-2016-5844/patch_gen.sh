project_name=libarchive
bug_id=CVE-2016-5844
dir_name=$1/vulnloc/$project_name/$bug_id

current_dir=$PWD
mkdir -p $dir_name
cd $dir_name
wget https://libarchive.org/downloads/libarchive-3.2.0.zip
unzip libarchive-3.2.0.zip
mv libarchive-3.2.0 src
cd src

fix_file=libarchive/archive_read_support_format_iso9660.c
backup_file=backup.c

cp $fix_file $backup_file

sed -i '1093i if(iso9660->entry_sparse_offset == 0) return (ARCHIVE_FATAL);' libarchive/archive_read_support_format_iso9660.c

diff -u $backup_file $fix_file > $2/$bug_id/cpr.patch
